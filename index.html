<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Horarios · LL. RR. · 2025 - 2026</title>
  <style>
    body{font-family:sans-serif;margin:0;padding:0;background:#f9f9f9}
    header{background:#900;color:#fff;padding:1rem;text-align:center;font-weight:bold}
    h1{margin:0;font-size:1.2rem}
    .chips{display:flex;flex-wrap:wrap;gap:.5rem;padding:.5rem}
    .chip{padding:.3rem .7rem;border-radius:15px;background:#eee;cursor:pointer;font-size:.9rem}
    .chip.active{background:#900;color:#fff}
    .card{background:#fff;margin:.5rem;padding:1rem;border-radius:10px;box-shadow:0 2px 4px rgba(0,0,0,.1)}
    .grade{font-weight:bold;margin-bottom:.5rem}
    .day{font-size:.9rem;margin:.3rem 0}
    .disc{color:#c00;font-weight:bold;margin-left:.5rem}
    #search{width:95%;margin:.5rem;padding:.5rem}
    #reset{margin:.5rem;padding:.3rem .7rem;border:none;background:#900;color:#fff;border-radius:5px;cursor:pointer}
  </style>
</head>
<body>
  <header>
    <div>LL. RR. · 2025 - 2026</div>
    <h1>Horarios · Club Deportivo</h1>
  </header>

  <input type="text" id="search" placeholder="Buscar…">
  <button id="reset">Reiniciar filtros</button>

  <div class="chips" id="discipline-chips"></div>
  <div class="chips" id="grade-chips"></div>
  <div class="chips" id="day-chips"></div>

  <div id="results"></div>

<script>
const SHEET_CSV_URL = "https://docs.google.com/spreadsheets/d/13YowVOIm6LWjbFuK1FiY9zyXbXzkKXZLmgcta-TDnkg/export?format=csv";
let DATA = [];
let filters = { discipline:"Todos", grade:"Todos", day:"Todos", search:"" };

const DAYS = ["Lunes","Martes","Miércoles","Jueves","Viernes","Sábado"];
const GRADES = ["1er Grado","2do Grado","3er Grado","4to Grado","5to Grado","6to Grado",
                "1er Año","2do Año","3er Año","4to Año","5to Año"];
function uniq(arr){return [...new Set(arr)].sort();}

function parseCSV(text){
  const lines=text.split(/\r?\n/).filter(l=>l.trim());
  const header=lines.shift().split(",");
  return lines.map(l=>{
    const parts=l.split(",");
    return {
      day:parts[0].trim(),
      grade:parts[1].trim(),
      discipline:parts[2].trim(),
      time:parts[3]?parts[3].trim():"",
      type:parts[4]?parts[4].trim():""
    };
  });
}

async function load(){
  try{
    const res=await fetch(SHEET_CSV_URL);
    const txt=await res.text();
    DATA=parseCSV(txt);
    buildChips();
    setTodayChip();
    render();
  }catch(e){console.error(e);}
}

function buildChips(){
  const disc=uniq(DATA.map(d=>d.discipline));
  const dc=document.getElementById("discipline-chips");
  dc.innerHTML="";
  ["Todos",...disc].forEach(x=>{
    const c=document.createElement("div");
    c.textContent=x;c.className="chip"+(x==="Todos"?" active":"");
    c.onclick=()=>{filters.discipline=x;setActive(dc,x);render();};
    dc.appendChild(c);
  });
  const gc=document.getElementById("grade-chips");
  gc.innerHTML="";
  ["Todos",...GRADES].forEach(x=>{
    const c=document.createElement("div");
    c.textContent=x;c.className="chip"+(x==="Todos"?" active":"");
    c.onclick=()=>{filters.grade=x;setActive(gc,x);render();};
    gc.appendChild(c);
  });
  const dch=document.getElementById("day-chips");
  dch.innerHTML="";
  ["Todos","Hoy",...DAYS].forEach(x=>{
    const c=document.createElement("div");
    c.textContent=x;c.className="chip"+(x==="Todos"?" active":"");
    c.onclick=()=>{filters.day=x==="Hoy"?todayName():x;setActive(dch,x);render();};
    dch.appendChild(c);
  });
}
function setActive(container,val){
  [...container.children].forEach(c=>c.classList.remove("active"));
  [...container.children].find(c=>c.textContent===val || (val===todayName() && c.textContent==="Hoy"))?.classList.add("active");
}
function todayName(){
  const n=(new Date()).getDay();
  return ["Domingo",...DAYS][n]||"";
}
function setTodayChip(){
  const d=todayName();
  if(DAYS.includes(d)){filters.day=d;setActive(document.getElementById("day-chips"),"Hoy");}
}
function render(){
  const out=document.getElementById("results");
  out.innerHTML="";
  let data=DATA;
  if(filters.discipline!=="Todos") data=data.filter(r=>r.discipline===filters.discipline);
  if(filters.grade!=="Todos") data=data.filter(r=>r.grade===filters.grade);
  if(filters.day!=="Todos") data=data.filter(r=>r.day===filters.day);
  if(filters.search) data=data.filter(r=>(r.grade+" "+r.discipline+" "+r.day).toLowerCase().includes(filters.search.toLowerCase()));
  const grouped={};
  data.forEach(r=>{
    if(!grouped[r.grade]) grouped[r.grade]={};
    if(!grouped[r.grade][r.day]) grouped[r.grade][r.day]=[];
    grouped[r.grade][r.day].push(r.discipline+(r.time?` (${r.time})`:""));
  });
  GRADES.forEach(g=>{
    if(!grouped[g]) return;
    const card=document.createElement("div");
    card.className="card";
    card.innerHTML=`<div class="grade">${g}</div>`;
    DAYS.forEach(d=>{
      if(grouped[g][d]){
        const line=document.createElement("div");
        line.className="day";
        line.textContent=d+": ";
        grouped[g][d].forEach(di=>{
          const span=document.createElement("span");
          span.className="disc";
          span.textContent=di;
          line.appendChild(span);
        });
        card.appendChild(line);
      }
    });
    out.appendChild(card);
  });
}

document.getElementById("search").oninput=e=>{filters.search=e.target.value;render();};
document.getElementById("reset").onclick=()=>{filters={discipline:"Todos",grade:"Todos",day:"Todos",search:""};buildChips();render();};

load();
</script>
</body>
</html>
